<!DOCTYPE html>
<html lang="{{if eq .Language "pt"}}pt-br{{else}}{{.Language}}{{end}}">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="{{.Answer}}" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://sumtube.io{{.Path}}" />
    <meta property="og:title" content="{{call .T "title_blog"}} : {{.Title}}" />
    <meta property="og:description" content="{{.Answer}}" />
    <meta property="og:image" content="https://img.youtube.com/vi/{{.VideoId}}/0.jpg" />
    <link rel="icon" href="https://d39ijcik5pqpvl.cloudfront.net/favicon.ico" sizes="32x32">

    {{range $lang, $path := .Paths}}
        <link rel="alternate" href="{{$path}}" hreflang="{{$lang}}" />
    {{end}}

    <title>{{call .T "title_blog"}} : {{.Title}} | Sumtube</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .markdown a[href^="https://youtu.be"] {
        text-decoration: underline dashed #e63946;   
        transition: color 0.2s ease;
      }

      .markdown h3 a {
        font-weight: 700;
      }

      .markdown a[href^="https://youtu.be"]:hover {
        color: #d62828;
        text-decoration: underline solid;
      }     
    </style>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-C5GYP3MLSG"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-C5GYP3MLSG');
    </script>
  </head>
  <body class="bg-gray-100 text-gray-800">
    <!-- Reused Header from Homepage -->
    <nav class="bg-red-600 p-4 text-white flex justify-between items-center">
      <h1 class="text-xl font-bold"><a href="{{.BaseUrl}}">YouTube Summarizer</a></h1>
      <button class="bg-white text-red-600 px-4 py-2 rounded">Login</button>
    </nav>

    <div class="max-w-6xl mx-auto p-4 lg:flex lg:gap-8">
      <!-- Main Content -->
      <main class="lg:w-2/3">
        <!-- Blog Header -->
        <img
          src="https://img.youtube.com/vi/{{.VideoId}}/0.jpg"
          alt="Video Cover"
          class="rounded-xl shadow mb-6 w-full"
        />

        <h1 class="text-3xl font-bold mb-2">
          {{.Title}}
        </h1>
        <p class="text-sm text-gray-500 mb-4 flex items-center gap-2">
          üìÖ {{.UploadDate}} ‚Ä¢ üé• {{.VideoDurationMinutes}} min v√≠deo ‚Üí
          üìñ {{.ReadingTimeMinutes}} min {{call .T "reading"}} ‚Ä¢
          ‚è±Ô∏è <span class="text-green-600 font-semibold">{{call .T "you_saved"}} {{.TimeSavedMinutes}} min</span>
        </p>

        <!-- Blog Content -->
        <article class="space-y-4 text-lg leading-relaxed">
          <i style="font-size: small;">{{.Answer}}</i>
        </article>

        <article class="space-y-4 text-lg leading-relaxed mt-3 markdown">
          {{.Content}}
        </article>
        {{ if eq .Content "" }}
          There's a error on this page. I will retry summarizing it again

          <script>
            setTimeout(()=>{
              const vid = "{{.VideoId}}";
              const lang = "{{.Language}}"
              const protocol = window.location.protocol;
              const hostname = window.location.hostname;
              const url = `${protocol}//${hostname}/${lang}/${vid}?retry=true`
              
              window.location.href = url

            },4000)
          </script>
        {{ end }}

        {{ if .CanBeRetried}}
        <div class="mt-6" >
          <button
            onclick="forceSummarize(this)"
            class="inline-block bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 flex items-center gap-2"
            data-lang = {{.Language}}
            data-vid = {{.VideoId}}
            id="force-summarize"
          >
          ‚Ü∫ Summarize Again
          </button>
        </div>
        {{ end }}

        <!-- Share Button -->
        <div class="mt-6">
          <button
            onclick="copyCurrentURL()"
            class="inline-block bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 flex items-center gap-2"
            id="shareButton"
          >
            üîó Share this summary
          </button>
        </div>
       

        <script>
          function copyCurrentURL() {
            const currentURL = window.location.href;
            navigator.clipboard.writeText(currentURL).then(() => {
              const shareButton = document.getElementById('shareButton');
              const originalText = shareButton.innerHTML;
              shareButton.innerHTML = '‚úÖ Copied!';
              setTimeout(() => {
                shareButton.innerHTML = originalText;
              }, 2000);
            }).catch(err => {
              console.error('Failed to copy URL:', err);
              alert('Failed to copy URL to clipboard');
            });
          }

          function forceSummarize(button) {
              // Disable the button while loading

              button.disabled = true
              button.classList.add("opacity-70", "cursor-not-allowed")
              const vid = "{{.VideoId}}";
              const lang = "{{.Language}}"

              // Store original text in case we want to revert later
              const originalText = button.innerHTML

              // Add a spinner (using Tailwind-style animation)
              button.innerHTML = `
                <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
                </svg>
                <span>Summarizing...</span>
              `

              // Simulate async process (e.g., API call)
              setTimeout(() => {
                // After done, restore button state
                button.disabled = false
                button.classList.remove("opacity-70", "cursor-not-allowed")
                button.innerHTML = originalText

                //check current domain with its http protocol
                const protocol = window.location.protocol;
                const hostname = window.location.hostname;
                const url = `${protocol}//${hostname}/${lang}/${vid}?retry=true`
                console.log(`Redirecting to ${url}...`)
                window.location.href = url
                
              }, 3000)
          }

        </script>

        <div class="max-w-2xl mx-auto mt-16 text-center pt-2 pb-2 bg-white">
          <h2 class="text-3xl font-bold">Summarize Any YouTube Video</h2>
          <p class="text-gray-600 mt-2">
            Enter a YouTube video URL and get an AI-generated summary.
          </p>

          <!-- React form mounts here -->
          <div
            id="react-root"
            class="mt-6 flex flex-col items-center justify-center gap-2 w-full"
            data-lang="{{.Language}}"
          >
            <!-- React replaces this -->
          </div>
        </div>

        <!-- Question Section -->
        <!-- <div class="mt-10 bg-white p-6 rounded-lg shadow-md">
          <h2 class="text-xl font-semibold mb-2">
            Have a question about the video?
          </h2>
          <p class="text-gray-600 mb-4">
            We'll use your question to improve this summary or create a new one.
          </p>
          <textarea
            class="w-full p-3 border rounded-lg resize-none"
            rows="4"
            placeholder="Type your question here..."
          ></textarea>
          <button
            class="mt-4 bg-red-600 text-white px-5 py-2 rounded hover:bg-red-700"
          >
            Submit
          </button>
        </div> -->
      </main>

      <!-- Related Videos Sidebar -->
      <aside class="lg:w-1/3 mt-10 lg:mt-0">
        <h3 class="text-lg font-semibold mb-4">üì∫ Related Videos</h3>
        <ul class="space-y-4">
          {{range .RelatedVideosArr}}
          <li class="flex gap-4 {{if eq .vid $.VideoId}}opacity-50{{end}}">
            <img
              src="https://img.youtube.com/vi/{{.vid}}/hqdefault.jpg"
              alt="{{.title}}"
              class="w-20 h-14 object-cover rounded"
            />
            <div>
              <a 
              href="{{$.BaseUrl}}/{{.lang}}/{{.vid}}/{{.path}}"  
              class="font-medium line-clamp-2 text-sm"
              title="{{.title}}"
              alt="{{.title}}">
                {{.title}}
              </a>
              <a 
                href="{{$.BaseUrl}}/{{.lang}}/{{.vid}}/{{.path}}" 
                class="text-sm text-red-600 hover:underline"
              >
                Watch Summary
              </a>
            </div>
          </li>
          {{end}}
        </ul>
      </aside>
    </div>
    <script type="module" src="/static/build/app.js"></script>
    <script src="/static/lang-handler.js"></script>
  </body>
</html>
